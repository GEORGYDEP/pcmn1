<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Le PCMN - Ma√Ætrise le Plan Comptable ! | Institut Saint-Luc</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg-dark: #0f1729;
  --bg-card: #1a2340;
  --bg-card-hover: #1e2a4a;
  --accent-blue: #4e7cff;
  --accent-cyan: #00d4aa;
  --accent-orange: #ff8c42;
  --accent-pink: #ff5e8a;
  --accent-purple: #a855f7;
  --accent-yellow: #fbbf24;
  --text-primary: #e8ecf4;
  --text-secondary: #8892a8;
  --text-muted: #5a6478;
  --success: #22c55e;
  --error: #ef4444;
  --border: rgba(78, 124, 255, 0.15);
  --glass: rgba(26, 35, 64, 0.85);
  --shadow: 0 8px 32px rgba(0,0,0,0.3);
  --radius: 16px;
  --radius-sm: 10px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

html { scroll-behavior: smooth; }

body {
  font-family: 'Nunito', sans-serif;
  background: var(--bg-dark);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: 
    radial-gradient(ellipse at 20% 20%, rgba(78, 124, 255, 0.08) 0%, transparent 50%),
    radial-gradient(ellipse at 80% 80%, rgba(0, 212, 170, 0.06) 0%, transparent 50%),
    radial-gradient(ellipse at 50% 50%, rgba(168, 85, 247, 0.04) 0%, transparent 50%);
  z-index: 0;
  animation: bgShift 20s ease-in-out infinite alternate;
}

@keyframes bgShift {
  0% { transform: translate(0, 0) rotate(0deg); }
  100% { transform: translate(-2%, -2%) rotate(3deg); }
}

/* ===== SCROLLBAR ===== */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--bg-dark); }
::-webkit-scrollbar-thumb { background: var(--accent-blue); border-radius: 4px; }

/* ===== ANIMATIONS ===== */
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes scaleIn {
  from { opacity: 0; transform: scale(0.8); }
  to { opacity: 1; transform: scale(1); }
}

@keyframes slideRight {
  from { opacity: 0; transform: translateX(-20px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

@keyframes shimmer {
  0% { background-position: -200% center; }
  100% { background-position: 200% center; }
}

@keyframes confetti-fall {
  0% { transform: translateY(-10px) rotate(0deg); opacity: 1; }
  100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-8px); }
  75% { transform: translateX(8px); }
}

@keyframes bounceIn {
  0% { transform: scale(0); }
  50% { transform: scale(1.15); }
  100% { transform: scale(1); }
}

@keyframes starPop {
  0% { transform: scale(0) rotate(-30deg); opacity: 0; }
  60% { transform: scale(1.3) rotate(10deg); opacity: 1; }
  100% { transform: scale(1) rotate(0deg); opacity: 1; }
}

.animate-in { animation: fadeInUp 0.5s ease-out forwards; }

/* ===== LAYOUT ===== */
.app-container {
  position: relative;
  z-index: 1;
  max-width: 1000px;
  margin: 0 auto;
  padding: 20px;
  min-height: 100vh;
}

/* ===== HEADER ===== */
.app-header {
  text-align: center;
  padding: 40px 20px 30px;
  animation: fadeInUp 0.6s ease-out;
}

.app-header .logo-badge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
  padding: 6px 16px;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 16px;
}

.app-header h1 {
  font-family: 'Fredoka', sans-serif;
  font-size: clamp(2rem, 5vw, 3rem);
  font-weight: 700;
  background: linear-gradient(135deg, #fff 0%, var(--accent-cyan) 50%, var(--accent-blue) 100%);
  background-size: 200% auto;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: shimmer 4s linear infinite;
  line-height: 1.2;
}

.app-header .subtitle {
  color: var(--text-secondary);
  font-size: 1rem;
  margin-top: 8px;
  font-weight: 500;
}

/* ===== PROGRESS BAR ===== */
.progress-section {
  margin: 20px 0 30px;
  animation: fadeInUp 0.6s ease-out 0.1s both;
}

.progress-stats {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
  font-size: 0.85rem;
}

.progress-stats .level-info {
  color: var(--accent-cyan);
  font-weight: 700;
  font-family: 'Fredoka', sans-serif;
}

.progress-stats .score-info {
  color: var(--accent-yellow);
  font-weight: 700;
}

.progress-bar-track {
  height: 12px;
  background: rgba(255,255,255,0.06);
  border-radius: 6px;
  overflow: hidden;
  border: 1px solid var(--border);
}

.progress-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent-blue), var(--accent-cyan), var(--accent-purple));
  background-size: 200% 100%;
  border-radius: 6px;
  transition: width 0.8s cubic-bezier(0.22, 1, 0.36, 1);
  animation: shimmer 3s linear infinite;
  width: 0%;
}

/* ===== EXERCISE NAVIGATION ===== */
.exercise-nav {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: 8px;
  margin-bottom: 30px;
  animation: fadeInUp 0.6s ease-out 0.2s both;
}

.nav-btn {
  position: relative;
  background: var(--bg-card);
  border: 2px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 12px 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
  color: var(--text-muted);
  font-family: 'Nunito', sans-serif;
  font-weight: 700;
  font-size: 0.75rem;
}

.nav-btn:hover { 
  border-color: var(--accent-blue);
  background: var(--bg-card-hover);
  color: var(--text-primary);
  transform: translateY(-2px);
}

.nav-btn.active {
  border-color: var(--accent-blue);
  background: linear-gradient(135deg, rgba(78,124,255,0.2), rgba(168,85,247,0.1));
  color: var(--text-primary);
}

.nav-btn.completed {
  border-color: var(--success);
  background: rgba(34, 197, 94, 0.1);
  color: var(--success);
}

.nav-btn.completed::after {
  content: '‚úì';
  position: absolute;
  top: -6px;
  right: -6px;
  background: var(--success);
  color: #fff;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  font-size: 0.65rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.nav-btn .nav-num {
  display: block;
  font-family: 'Fredoka', sans-serif;
  font-size: 1.3rem;
  margin-bottom: 2px;
}

.nav-btn.locked {
  opacity: 0.4;
  cursor: not-allowed;
}

/* ===== EXERCISE PANEL ===== */
.exercise-panel {
  display: none;
  animation: fadeInUp 0.4s ease-out;
}

.exercise-panel.active { display: block; }

.panel-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 30px;
  margin-bottom: 20px;
  box-shadow: var(--shadow);
}

.panel-card .ex-header {
  display: flex;
  align-items: center;
  gap: 14px;
  margin-bottom: 20px;
}

.ex-icon {
  width: 50px;
  height: 50px;
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  flex-shrink: 0;
}

.ex-header h2 {
  font-family: 'Fredoka', sans-serif;
  font-size: 1.4rem;
  font-weight: 600;
  line-height: 1.3;
}

.ex-header .ex-desc {
  color: var(--text-secondary);
  font-size: 0.85rem;
  margin-top: 2px;
}

/* ===== THEORY BOX ===== */
.theory-box {
  background: linear-gradient(135deg, rgba(78,124,255,0.08), rgba(0,212,170,0.05));
  border: 1px solid rgba(78,124,255,0.2);
  border-radius: var(--radius-sm);
  padding: 18px 20px;
  margin-bottom: 24px;
  font-size: 0.9rem;
  line-height: 1.7;
}

.theory-box .theory-title {
  font-family: 'Fredoka', sans-serif;
  font-weight: 600;
  color: var(--accent-cyan);
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.theory-box code {
  background: rgba(255,255,255,0.08);
  padding: 2px 8px;
  border-radius: 4px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.85em;
  color: var(--accent-yellow);
}

/* ===== QUESTION AREA ===== */
.question-area {
  margin-bottom: 24px;
}

.question-text {
  font-size: 1.05rem;
  font-weight: 600;
  margin-bottom: 16px;
  line-height: 1.5;
}

.question-counter {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: rgba(78,124,255,0.15);
  color: var(--accent-blue);
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 700;
  margin-bottom: 12px;
  font-family: 'Fredoka', sans-serif;
}

.question-scenario {
  background: rgba(255,140,66,0.08);
  border-left: 3px solid var(--accent-orange);
  padding: 12px 16px;
  border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
  margin-bottom: 16px;
  font-size: 0.9rem;
  color: var(--text-secondary);
  line-height: 1.6;
}

/* ===== OPTIONS (MCQ) ===== */
.options-grid {
  display: grid;
  gap: 10px;
}

.option-btn {
  background: rgba(255,255,255,0.03);
  border: 2px solid rgba(255,255,255,0.08);
  border-radius: var(--radius-sm);
  padding: 14px 18px;
  cursor: pointer;
  transition: all 0.25s ease;
  text-align: left;
  font-family: 'Nunito', sans-serif;
  font-size: 0.95rem;
  font-weight: 500;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 12px;
}

.option-btn:hover {
  border-color: var(--accent-blue);
  background: rgba(78,124,255,0.08);
  transform: translateX(4px);
}

.option-btn .opt-letter {
  width: 32px;
  height: 32px;
  border-radius: 8px;
  background: rgba(78,124,255,0.15);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 0.85rem;
  color: var(--accent-blue);
  flex-shrink: 0;
  font-family: 'JetBrains Mono', monospace;
}

.option-btn.correct {
  border-color: var(--success);
  background: rgba(34,197,94,0.1);
  animation: bounceIn 0.3s ease-out;
}

.option-btn.correct .opt-letter {
  background: var(--success);
  color: #fff;
}

.option-btn.wrong {
  border-color: var(--error);
  background: rgba(239,68,68,0.08);
  animation: shake 0.4s ease-out;
}

.option-btn.wrong .opt-letter {
  background: var(--error);
  color: #fff;
}

.option-btn.disabled {
  pointer-events: none;
  opacity: 0.5;
}

/* ===== DRAG & DROP ===== */
.drop-zones {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 14px;
  margin-bottom: 20px;
}

.drop-zone {
  background: rgba(255,255,255,0.02);
  border: 2px dashed rgba(255,255,255,0.1);
  border-radius: var(--radius-sm);
  padding: 14px;
  min-height: 100px;
  transition: all 0.3s ease;
}

.drop-zone.drag-over {
  border-color: var(--accent-cyan);
  background: rgba(0,212,170,0.05);
}

.drop-zone .zone-label {
  font-family: 'Fredoka', sans-serif;
  font-weight: 600;
  font-size: 0.85rem;
  margin-bottom: 8px;
  color: var(--text-secondary);
  text-align: center;
}

.drag-items {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 20px;
  min-height: 50px;
  padding: 10px;
  background: rgba(255,255,255,0.02);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
}

.drag-item {
  background: linear-gradient(135deg, var(--bg-card-hover), var(--bg-card));
  border: 1px solid var(--border);
  padding: 8px 14px;
  border-radius: 8px;
  cursor: grab;
  font-size: 0.85rem;
  font-weight: 600;
  transition: all 0.2s ease;
  user-select: none;
}

.drag-item:hover {
  border-color: var(--accent-blue);
  transform: translateY(-2px);
}

.drag-item:active { cursor: grabbing; }

.drag-item.placed {
  opacity: 0.3;
  pointer-events: none;
}

.dropped-item {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: rgba(78,124,255,0.12);
  border: 1px solid rgba(78,124,255,0.3);
  padding: 5px 10px;
  border-radius: 6px;
  font-size: 0.8rem;
  font-weight: 600;
  margin: 3px;
  cursor: pointer;
}

.dropped-item:hover { background: rgba(239,68,68,0.15); border-color: var(--error); }

.dropped-item.correct-item { border-color: var(--success); background: rgba(34,197,94,0.12); }
.dropped-item.wrong-item { border-color: var(--error); background: rgba(239,68,68,0.12); }

/* ===== TABLE EXERCISES ===== */
.account-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  border-radius: var(--radius-sm);
  overflow: hidden;
  margin-bottom: 16px;
  font-size: 0.85rem;
}

.account-table th {
  background: linear-gradient(135deg, rgba(78,124,255,0.2), rgba(168,85,247,0.1));
  padding: 10px 12px;
  font-weight: 700;
  text-align: center;
  font-size: 0.8rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 2px solid var(--accent-blue);
}

.account-table td {
  padding: 8px 12px;
  text-align: center;
  border-bottom: 1px solid var(--border);
  background: rgba(255,255,255,0.01);
}

.account-table tr:hover td {
  background: rgba(255,255,255,0.03);
}

.account-table .debit-col { color: var(--accent-orange); font-weight: 600; }
.account-table .credit-col { color: var(--accent-cyan); font-weight: 600; }
.account-table .solde-col { color: var(--accent-yellow); font-weight: 700; }

.account-table input {
  background: rgba(255,255,255,0.05);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 6px 8px;
  color: var(--text-primary);
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.85rem;
  text-align: center;
  width: 90px;
  transition: border-color 0.2s;
}

.account-table input:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: rgba(78,124,255,0.08);
}

.account-table input.input-correct {
  border-color: var(--success);
  background: rgba(34,197,94,0.1);
  color: var(--success);
}

.account-table input.input-wrong {
  border-color: var(--error);
  background: rgba(239,68,68,0.08);
  color: var(--error);
}

.account-title-bar {
  background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
  color: white;
  padding: 10px 16px;
  border-radius: var(--radius-sm) var(--radius-sm) 0 0;
  font-family: 'Fredoka', sans-serif;
  font-weight: 600;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* ===== MATCHING ===== */
.match-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.match-col { display: flex; flex-direction: column; gap: 8px; }

.match-item {
  background: rgba(255,255,255,0.03);
  border: 2px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 12px 16px;
  cursor: pointer;
  transition: all 0.25s ease;
  font-size: 0.9rem;
  font-weight: 500;
}

.match-item:hover {
  border-color: var(--accent-blue);
  background: rgba(78,124,255,0.06);
}

.match-item.selected {
  border-color: var(--accent-cyan);
  background: rgba(0,212,170,0.1);
  box-shadow: 0 0 12px rgba(0,212,170,0.15);
}

.match-item.matched {
  border-color: var(--success);
  background: rgba(34,197,94,0.08);
  opacity: 0.6;
  pointer-events: none;
}

.match-item.wrong-match {
  animation: shake 0.4s ease-out;
  border-color: var(--error);
}

/* ===== BUTTONS ===== */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 12px 24px;
  border: none;
  border-radius: var(--radius-sm);
  font-family: 'Nunito', sans-serif;
  font-weight: 700;
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.25s ease;
}

.btn-primary {
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
  color: white;
}

.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(78,124,255,0.3); }

.btn-success {
  background: linear-gradient(135deg, var(--success), #16a34a);
  color: white;
}

.btn-success:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(34,197,94,0.3); }

.btn-outline {
  background: transparent;
  border: 2px solid var(--border);
  color: var(--text-secondary);
}

.btn-outline:hover { border-color: var(--accent-blue); color: var(--text-primary); }

.btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none !important; }

.btn-group {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 20px;
}

/* ===== FEEDBACK ===== */
.feedback-bar {
  padding: 14px 18px;
  border-radius: var(--radius-sm);
  margin-top: 16px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 10px;
  animation: bounceIn 0.3s ease-out;
  font-size: 0.9rem;
}

.feedback-bar.success {
  background: rgba(34,197,94,0.1);
  border: 1px solid rgba(34,197,94,0.3);
  color: var(--success);
}

.feedback-bar.error {
  background: rgba(239,68,68,0.08);
  border: 1px solid rgba(239,68,68,0.3);
  color: var(--error);
}

.feedback-bar.info {
  background: rgba(78,124,255,0.08);
  border: 1px solid rgba(78,124,255,0.3);
  color: var(--accent-blue);
}

/* ===== SCORE DISPLAY ===== */
.score-display {
  text-align: center;
  padding: 30px;
  animation: scaleIn 0.5s ease-out;
}

.score-circle {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  margin: 0 auto 16px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-family: 'Fredoka', sans-serif;
  border: 4px solid;
}

.score-circle .score-num {
  font-size: 2.2rem;
  font-weight: 700;
  line-height: 1;
}

.score-circle .score-label {
  font-size: 0.75rem;
  font-weight: 500;
}

.score-circle.gold { border-color: var(--accent-yellow); color: var(--accent-yellow); background: rgba(251,191,36,0.08); }
.score-circle.silver { border-color: var(--text-secondary); color: var(--text-secondary); background: rgba(136,146,168,0.08); }
.score-circle.bronze { border-color: var(--accent-orange); color: var(--accent-orange); background: rgba(255,140,66,0.08); }

.stars-row {
  font-size: 1.8rem;
  margin-bottom: 12px;
}

.stars-row .star {
  display: inline-block;
  animation: starPop 0.4s ease-out both;
}

.stars-row .star:nth-child(1) { animation-delay: 0.1s; }
.stars-row .star:nth-child(2) { animation-delay: 0.25s; }
.stars-row .star:nth-child(3) { animation-delay: 0.4s; }

/* ===== INTRO / WELCOME ===== */
.welcome-panel { text-align: center; }

.welcome-panel .mascot {
  font-size: 4rem;
  margin-bottom: 16px;
  animation: pulse 2s ease-in-out infinite;
}

.welcome-panel p {
  color: var(--text-secondary);
  max-width: 600px;
  margin: 0 auto 24px;
  line-height: 1.7;
}

.feature-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 12px;
  margin: 24px 0;
}

.feature-card {
  background: rgba(255,255,255,0.03);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 16px;
  text-align: center;
}

.feature-card .feat-icon { font-size: 1.8rem; margin-bottom: 8px; }
.feature-card .feat-title { font-weight: 700; font-size: 0.85rem; margin-bottom: 4px; }
.feature-card .feat-desc { font-size: 0.75rem; color: var(--text-muted); }

/* ===== VF TOGGLE ===== */
.vf-toggle-group {
  display: flex;
  gap: 10px;
}

.vf-btn {
  flex: 1;
  padding: 10px;
  border: 2px solid var(--border);
  border-radius: var(--radius-sm);
  background: transparent;
  color: var(--text-secondary);
  font-family: 'Nunito', sans-serif;
  font-weight: 700;
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.2s;
}

.vf-btn:hover { border-color: var(--accent-blue); color: var(--text-primary); }
.vf-btn.selected-v { border-color: var(--success); background: rgba(34,197,94,0.1); color: var(--success); }
.vf-btn.selected-f { border-color: var(--error); background: rgba(239,68,68,0.08); color: var(--error); }
.vf-btn.correct-answer { border-color: var(--success); background: rgba(34,197,94,0.15); color: var(--success); }
.vf-btn.wrong-answer { border-color: var(--error); background: rgba(239,68,68,0.15); color: var(--error); }

/* ===== SELECT DROPDOWN ===== */
.styled-select {
  background: rgba(255,255,255,0.05);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 6px 10px;
  color: var(--text-primary);
  font-family: 'Nunito', sans-serif;
  font-size: 0.85rem;
  cursor: pointer;
  min-width: 80px;
}

.styled-select:focus { outline: none; border-color: var(--accent-blue); }
.styled-select.input-correct { border-color: var(--success); background: rgba(34,197,94,0.1); }
.styled-select.input-wrong { border-color: var(--error); background: rgba(239,68,68,0.08); }

/* ===== CONFETTI ===== */
.confetti-piece {
  position: fixed;
  width: 10px;
  height: 10px;
  top: -10px;
  z-index: 9999;
  animation: confetti-fall linear forwards;
  pointer-events: none;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 600px) {
  .app-container { padding: 12px; }
  .panel-card { padding: 18px; }
  .exercise-nav { grid-template-columns: repeat(4, 1fr); }
  .match-container { grid-template-columns: 1fr; }
  .drop-zones { grid-template-columns: 1fr; }
  .account-table { font-size: 0.75rem; }
  .account-table input { width: 70px; font-size: 0.75rem; }
}

/* ===== TOOLTIP ===== */
.tooltip {
  position: relative;
}

.tooltip::after {
  content: attr(data-tip);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: var(--bg-card);
  border: 1px solid var(--border);
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 0.75rem;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
  z-index: 10;
}

.tooltip:hover::after { opacity: 1; }

/* ===== BILAN TABLE ===== */
.bilan-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2px;
  background: var(--border);
  border-radius: var(--radius-sm);
  overflow: hidden;
  margin-bottom: 16px;
}

.bilan-side {
  background: var(--bg-card);
  padding: 14px;
}

.bilan-side h3 {
  font-family: 'Fredoka', sans-serif;
  font-size: 1rem;
  margin-bottom: 10px;
  text-align: center;
  padding-bottom: 8px;
  border-bottom: 2px solid;
}

.bilan-side.actif h3 { border-color: var(--accent-blue); color: var(--accent-blue); }
.bilan-side.passif h3 { border-color: var(--accent-orange); color: var(--accent-orange); }

.bilan-row {
  display: flex;
  justify-content: space-between;
  padding: 6px 0;
  font-size: 0.85rem;
  border-bottom: 1px solid rgba(255,255,255,0.04);
}

.bilan-row .bilan-amount {
  font-family: 'JetBrains Mono', monospace;
  font-weight: 600;
}

.bilan-total {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  font-weight: 700;
  font-family: 'Fredoka', sans-serif;
  border-top: 2px solid var(--accent-cyan);
  margin-top: 8px;
}

/* ===== HIDDEN ===== */
.hidden { display: none !important; }
</style>
</head>
<body>

<div class="app-container">
  <!-- HEADER -->
  <header class="app-header">
    <div class="logo-badge">üìä Institut Saint-Luc de Frameries</div>
    <h1>Ma√Ætrise le Plan Comptable !</h1>
    <p class="subtitle">Le PCMN belge et les comptes de bilan ‚Äî 7 d√©fis pour devenir un pro üöÄ</p>
  </header>

  <!-- PROGRESS -->
  <div class="progress-section">
    <div class="progress-stats">
      <span class="level-info" id="levelInfo">Niveau 0/7</span>
      <span class="score-info" id="totalScore">‚≠ê 0 points</span>
    </div>
    <div class="progress-bar-track">
      <div class="progress-bar-fill" id="progressFill"></div>
    </div>
  </div>

  <!-- EXERCISE NAV -->
  <div class="exercise-nav" id="exerciseNav"></div>

  <!-- ==================== WELCOME ==================== -->
  <div class="exercise-panel active" id="panel-welcome">
    <div class="panel-card welcome-panel">
      <div class="mascot">üßë‚Äçüíº</div>
      <h2 style="font-family:'Fredoka',sans-serif; font-size:1.6rem; margin-bottom:12px;">Bienvenue, futur(e) comptable !</h2>
      <p>Tu vas d√©couvrir le <strong>Plan Comptable Minimum Normalis√© (PCMN)</strong> √† travers 7 exercices progressifs. Chaque exercice r√©ussi te rapporte des points et des √©toiles. Pr√™t(e) √† relever le d√©fi ?</p>
      
      <div class="feature-grid">
        <div class="feature-card">
          <div class="feat-icon">üè∑Ô∏è</div>
          <div class="feat-title">7 Classes</div>
          <div class="feat-desc">D√©couvre les classes du PCMN</div>
        </div>
        <div class="feature-card">
          <div class="feat-icon">üî¢</div>
          <div class="feat-title">Codification</div>
          <div class="feat-desc">Ma√Ætrise les num√©ros de comptes</div>
        </div>
        <div class="feature-card">
          <div class="feat-icon">‚öñÔ∏è</div>
          <div class="feat-title">D√©bit / Cr√©dit</div>
          <div class="feat-desc">Comprends les r√®gles de base</div>
        </div>
        <div class="feature-card">
          <div class="feat-icon">üìã</div>
          <div class="feat-title">Comptes</div>
          <div class="feat-desc">Compl√®te des comptes r√©els</div>
        </div>
      </div>

      <button class="btn btn-primary" onclick="startGame()" style="font-size:1.1rem; padding:14px 36px; margin-top:10px;">
        üéÆ C'est parti !
      </button>
    </div>
  </div>

  <!-- ==================== EX 1: CLASSES DU PCMN ==================== -->
  <div class="exercise-panel" id="panel-ex1">
    <div class="panel-card">
      <div class="ex-header">
        <div class="ex-icon" style="background:rgba(78,124,255,0.15);">üè∑Ô∏è</div>
        <div>
          <h2>Exercice 1 ‚Äî Les 7 classes du PCMN</h2>
          <div class="ex-desc">Identifie la classe de chaque compte</div>
        </div>
      </div>

      <div class="theory-box">
        <div class="theory-title">üí° Rappel</div>
        Le PCMN belge est organis√© en <strong>7 classes</strong>. Le <strong>premier chiffre</strong> du num√©ro de compte indique sa classe.<br>
        Classes <code>1 √† 5</code> = Comptes de <strong>BILAN</strong> &nbsp;|&nbsp; Classes <code>6</code> et <code>7</code> = Comptes de <strong>GESTION</strong>
      </div>

      <div id="ex1-content"></div>
      <div id="ex1-feedback"></div>
      <div class="btn-group" id="ex1-buttons"></div>
    </div>
  </div>

  <!-- ==================== EX 2: CODIFICATION D√âCIMALE ==================== -->
  <div class="exercise-panel" id="panel-ex2">
    <div class="panel-card">
      <div class="ex-header">
        <div class="ex-icon" style="background:rgba(0,212,170,0.15);">üî¢</div>
        <div>
          <h2>Exercice 2 ‚Äî La codification d√©cimale</h2>
          <div class="ex-desc">Comprends la structure des num√©ros de comptes</div>
        </div>
      </div>

      <div class="theory-box">
        <div class="theory-title">üí° Rappel</div>
        Plus un num√©ro de compte contient de chiffres, plus il est <strong>pr√©cis</strong> :<br>
        <code>4</code> = Classe ‚Üí <code>40</code> = Sous-classe ‚Üí <code>400</code> = Compte ‚Üí <code>4000</code> = Sous-compte<br>
        ‚ö†Ô∏è Les comptes √† 1 ou 2 chiffres sont des <strong>comptes-titres</strong> : on n'y enregistre jamais d'op√©ration !
      </div>

      <div id="ex2-content"></div>
      <div id="ex2-feedback"></div>
      <div class="btn-group" id="ex2-buttons"></div>
    </div>
  </div>

  <!-- ==================== EX 3: VRAI OU FAUX ==================== -->
  <div class="exercise-panel" id="panel-ex3">
    <div class="panel-card">
      <div class="ex-header">
        <div class="ex-icon" style="background:rgba(255,94,138,0.15);">‚úÖ</div>
        <div>
          <h2>Exercice 3 ‚Äî Vrai ou Faux ?</h2>
          <div class="ex-desc">Teste tes connaissances du PCMN</div>
        </div>
      </div>

      <div id="ex3-content"></div>
      <div id="ex3-feedback"></div>
      <div class="btn-group" id="ex3-buttons"></div>
    </div>
  </div>

  <!-- ==================== EX 4: DU CONCRET AU COMPTABLE ==================== -->
  <div class="exercise-panel" id="panel-ex4">
    <div class="panel-card">
      <div class="ex-header">
        <div class="ex-icon" style="background:rgba(255,140,66,0.15);">üè™</div>
        <div>
          <h2>Exercice 4 ‚Äî Du concret au comptable</h2>
          <div class="ex-desc">Associe les √©l√©ments r√©els aux bons comptes</div>
        </div>
      </div>

      <div class="theory-box">
        <div class="theory-title">üí° Sc√©nario</div>
        Tu travailles chez <strong>BelgaTech SRL</strong>, une entreprise qui vend du mat√©riel informatique √† Mons. 
        Le comptable t'a demand√© d'identifier les comptes correspondant aux √©l√©ments de l'entreprise.
      </div>

      <div id="ex4-content"></div>
      <div id="ex4-feedback"></div>
      <div class="btn-group" id="ex4-buttons"></div>
    </div>
  </div>

  <!-- ==================== EX 5: ACTIF OU PASSIF + D√âBIT/CR√âDIT ==================== -->
  <div class="exercise-panel" id="panel-ex5">
    <div class="panel-card">
      <div class="ex-header">
        <div class="ex-icon" style="background:rgba(168,85,247,0.15);">‚öñÔ∏è</div>
        <div>
          <h2>Exercice 5 ‚Äî Actif, Passif & D√©bit/Cr√©dit</h2>
          <div class="ex-desc">Ma√Ætrise les r√®gles de fonctionnement des comptes</div>
        </div>
      </div>

      <div class="theory-box">
        <div class="theory-title">üí° Rappel des r√®gles</div>
        <strong>Compte d'ACTIF :</strong> augmentation au <code>D√âBIT</code>, diminution au <code>CR√âDIT</code><br>
        <strong>Compte de PASSIF :</strong> augmentation au <code>CR√âDIT</code>, diminution au <code>D√âBIT</code><br>
        Le solde d'un compte d'actif est toujours <strong>d√©biteur</strong>, celui d'un compte de passif est toujours <strong>cr√©diteur</strong>.
      </div>

      <div id="ex5-content"></div>
      <div id="ex5-feedback"></div>
      <div class="btn-group" id="ex5-buttons"></div>
    </div>
  </div>

  <!-- ==================== EX 6: COMPL√âTER UN COMPTE ==================== -->
  <div class="exercise-panel" id="panel-ex6">
    <div class="panel-card">
      <div class="ex-header">
        <div class="ex-icon" style="background:rgba(251,191,36,0.15);">üìã</div>
        <div>
          <h2>Exercice 6 ‚Äî Compl√©ter un compte</h2>
          <div class="ex-desc">Remplis les comptes d'actif et de passif</div>
        </div>
      </div>

      <div class="theory-box">
        <div class="theory-title">üí° Sc√©nario</div>
        L'entreprise <strong>FleurShop SRL</strong> (fleuriste √† Frameries) a commenc√© son activit√© le 2 janvier. 
        Tu dois compl√©ter ses comptes en calculant correctement les soldes apr√®s chaque op√©ration.
      </div>

      <div id="ex6-content"></div>
      <div id="ex6-feedback"></div>
      <div class="btn-group" id="ex6-buttons"></div>
    </div>
  </div>

  <!-- ==================== EX 7: SITUATION COMPL√àTE ==================== -->
  <div class="exercise-panel" id="panel-ex7">
    <div class="panel-card">
      <div class="ex-header">
        <div class="ex-icon" style="background:rgba(34,197,94,0.15);">üèÜ</div>
        <div>
          <h2>Exercice 7 ‚Äî Situation compl√®te</h2>
          <div class="ex-desc">Dresse le bilan d'une entreprise</div>
        </div>
      </div>

      <div class="theory-box">
        <div class="theory-title">üí° D√©fi final</div>
        L'entreprise <strong>PixelWeb SRL</strong> (agence web √† Charleroi) vient de se cr√©er. 
        √Ä partir de la liste de ses avoirs et dettes, tu dois classer chaque √©l√©ment au bon endroit dans le bilan 
        et v√©rifier l'√©quilibre <code>ACTIF = PASSIF</code>.
      </div>

      <div id="ex7-content"></div>
      <div id="ex7-feedback"></div>
      <div class="btn-group" id="ex7-buttons"></div>
    </div>
  </div>

  <!-- ==================== FINAL RESULTS ==================== -->
  <div class="exercise-panel" id="panel-final">
    <div class="panel-card" style="text-align:center; padding:40px;">
      <div id="final-content"></div>
    </div>
  </div>

</div>

<script>
// ============================================================
// APP STATE
// ============================================================
const state = {
  currentExercise: 0, // 0 = welcome
  scores: [0,0,0,0,0,0,0],
  maxScores: [0,0,0,0,0,0,0],
  completed: [false,false,false,false,false,false,false],
  totalScore: 0,
  currentQ: 0
};

const exercises = [
  { id: 'ex1', name: 'Classes', icon: 'üè∑Ô∏è' },
  { id: 'ex2', name: 'Codification', icon: 'üî¢' },
  { id: 'ex3', name: 'Vrai/Faux', icon: '‚úÖ' },
  { id: 'ex4', name: 'Concret', icon: 'üè™' },
  { id: 'ex5', name: 'D√©bit/Cr√©dit', icon: '‚öñÔ∏è' },
  { id: 'ex6', name: 'Comptes', icon: 'üìã' },
  { id: 'ex7', name: 'Bilan', icon: 'üèÜ' }
];

// ============================================================
// NAV & UI
// ============================================================
function buildNav() {
  const nav = document.getElementById('exerciseNav');
  nav.innerHTML = exercises.map((ex, i) => `
    <button class="nav-btn ${i === 0 ? '' : 'locked'}" id="nav-${i}" onclick="goToExercise(${i+1})">
      <span class="nav-num">${ex.icon}</span>
      Ex ${i+1}
    </button>
  `).join('');
}

function updateNav() {
  exercises.forEach((ex, i) => {
    const btn = document.getElementById(`nav-${i}`);
    btn.className = 'nav-btn';
    if (state.completed[i]) btn.classList.add('completed');
    if (state.currentExercise === i+1) btn.classList.add('active');
    // Unlock: first always unlocked, or previous completed
    if (i === 0 || state.completed[i-1]) {
      btn.classList.remove('locked');
    } else if (!state.completed[i]) {
      btn.classList.add('locked');
    }
  });
}

function updateProgress() {
  const done = state.completed.filter(Boolean).length;
  document.getElementById('levelInfo').textContent = `Niveau ${done}/7`;
  document.getElementById('totalScore').textContent = `‚≠ê ${state.totalScore} points`;
  document.getElementById('progressFill').style.width = `${(done/7)*100}%`;
}

function showPanel(id) {
  document.querySelectorAll('.exercise-panel').forEach(p => p.classList.remove('active'));
  const panel = document.getElementById(`panel-${id}`);
  if (panel) { panel.classList.add('active'); panel.style.animation = 'none'; panel.offsetHeight; panel.style.animation = 'fadeInUp 0.4s ease-out'; }
}

function goToExercise(num) {
  const btn = document.getElementById(`nav-${num-1}`);
  if (btn && btn.classList.contains('locked')) return;
  state.currentExercise = num;
  state.currentQ = 0;
  showPanel(exercises[num-1].id);
  updateNav();
  window[`initEx${num}`]();
}

function startGame() {
  goToExercise(1);
}

function completeExercise(exIdx, score, maxScore) {
  state.scores[exIdx] = Math.max(state.scores[exIdx], score);
  state.maxScores[exIdx] = maxScore;
  if (!state.completed[exIdx]) {
    state.completed[exIdx] = true;
    state.totalScore += score;
  }
  updateProgress();
  updateNav();
  
  // Check if all done
  if (state.completed.every(Boolean)) {
    setTimeout(() => showFinalResults(), 300);
  }
}

function getStars(score, max) {
  const pct = score / max;
  if (pct >= 0.9) return 3;
  if (pct >= 0.6) return 2;
  if (pct > 0) return 1;
  return 0;
}

function starsHTML(count) {
  return Array.from({length: 3}, (_, i) => 
    `<span class="star">${i < count ? '‚≠ê' : '‚òÜ'}</span>`
  ).join('');
}

function showExerciseResult(containerId, btnContainerId, exIdx, score, maxScore) {
  const stars = getStars(score, maxScore);
  const pct = Math.round((score/maxScore)*100);
  const circleClass = stars === 3 ? 'gold' : stars === 2 ? 'silver' : 'bronze';
  
  let msg = '';
  if (pct >= 90) msg = 'Excellent travail ! Tu ma√Ætrises parfaitement ce sujet ! üéâ';
  else if (pct >= 70) msg = 'Tr√®s bien ! Encore un petit effort pour la perfection !';
  else if (pct >= 50) msg = 'Pas mal ! Revois le rappel th√©orique pour t\'am√©liorer.';
  else msg = 'Continue tes efforts ! Relis la th√©orie et r√©essaie. üí™';

  document.getElementById(containerId).innerHTML = `
    <div class="score-display">
      <div class="stars-row">${starsHTML(stars)}</div>
      <div class="score-circle ${circleClass}">
        <span class="score-num">${pct}%</span>
        <span class="score-label">${score}/${maxScore} pts</span>
      </div>
      <p style="margin-top:16px; color:var(--text-secondary);">${msg}</p>
    </div>
  `;

  const nextIdx = exIdx + 1;
  let btns = `<button class="btn btn-outline" onclick="goToExercise(${exIdx+1})">üîÑ Recommencer</button>`;
  if (nextIdx < 7) {
    btns += `<button class="btn btn-primary" onclick="goToExercise(${nextIdx+1})">Exercice suivant ‚ûú</button>`;
  } else {
    btns += `<button class="btn btn-success" onclick="showFinalResults()">üèÜ Voir mes r√©sultats</button>`;
  }
  document.getElementById(btnContainerId).innerHTML = btns;

  completeExercise(exIdx, score, maxScore);
  if (pct >= 90) launchConfetti();
}

// ============================================================
// CONFETTI
// ============================================================
function launchConfetti() {
  const colors = ['#4e7cff','#00d4aa','#ff8c42','#ff5e8a','#a855f7','#fbbf24'];
  for (let i = 0; i < 40; i++) {
    const piece = document.createElement('div');
    piece.className = 'confetti-piece';
    piece.style.left = Math.random() * 100 + 'vw';
    piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
    piece.style.width = (Math.random() * 8 + 5) + 'px';
    piece.style.height = (Math.random() * 8 + 5) + 'px';
    piece.style.animationDuration = (Math.random() * 2 + 2) + 's';
    piece.style.animationDelay = Math.random() * 0.5 + 's';
    document.body.appendChild(piece);
    setTimeout(() => piece.remove(), 4500);
  }
}

// ============================================================
// EXERCISE 1: LES 7 CLASSES DU PCMN
// ============================================================
const ex1Questions = [
  { account: "Capital souscrit", num: "100", answer: 1, className: "Fonds propres, provisions et dettes √† + 1 an" },
  { account: "Terrains", num: "220", answer: 2, className: "Frais d'√©tab., actifs immobilis√©s, cr√©ances √† + 1 an" },
  { account: "Marchandises", num: "340", answer: 3, className: "Stocks et commandes en cours d'ex√©cution" },
  { account: "Fournisseurs", num: "440", answer: 4, className: "Cr√©ances et dettes √† 1 an au plus" },
  { account: "Caisse esp√®ces", num: "570", answer: 5, className: "Placements de tr√©sorerie et valeurs disponibles" },
  { account: "Achats de marchandises", num: "604", answer: 6, className: "Charges" },
  { account: "Chiffre d'affaires", num: "700", answer: 7, className: "Produits" },
  { account: "Clients", num: "400", answer: 4, className: "Cr√©ances et dettes √† 1 an au plus" },
  { account: "Mobilier et mat√©riel de bureau", num: "240", answer: 2, className: "Frais d'√©tab., actifs immobilis√©s, cr√©ances √† + 1 an" },
  { account: "Banque compte courant", num: "550", answer: 5, className: "Placements de tr√©sorerie et valeurs disponibles" },
  { account: "R√©serve l√©gale", num: "130", answer: 1, className: "Fonds propres, provisions et dettes √† + 1 an" },
  { account: "Mat√©riel roulant", num: "241", answer: 2, className: "Frais d'√©tab., actifs immobilis√©s, cr√©ances √† + 1 an" },
];

let ex1Data = {};

function initEx1() {
  ex1Data = { questions: shuffle([...ex1Questions]).slice(0, 8), current: 0, score: 0, answered: false };
  renderEx1();
}

function renderEx1() {
  const d = ex1Data;
  if (d.current >= d.questions.length) {
    showExerciseResult('ex1-content', 'ex1-buttons', 0, d.score, d.questions.length);
    return;
  }
  const q = d.questions[d.current];
  d.answered = false;
  document.getElementById('ex1-feedback').innerHTML = '';
  
  const options = [1,2,3,4,5,6,7];
  document.getElementById('ex1-content').innerHTML = `
    <div class="question-counter">Question ${d.current+1}/${d.questions.length}</div>
    <div class="question-text">Le compte <span style="color:var(--accent-cyan);">${q.num} ${q.account}</span> appartient √† quelle classe ?</div>
    <div class="options-grid">
      ${options.map(c => `
        <button class="option-btn" onclick="answerEx1(${c})" id="ex1-opt-${c}">
          <span class="opt-letter">${c}</span>
          <span>Classe ${c}</span>
        </button>
      `).join('')}
    </div>
  `;
  document.getElementById('ex1-buttons').innerHTML = '';
}

function answerEx1(chosen) {
  if (ex1Data.answered) return;
  ex1Data.answered = true;
  const q = ex1Data.questions[ex1Data.current];
  const correct = chosen === q.answer;
  
  document.querySelectorAll('#ex1-content .option-btn').forEach(b => b.classList.add('disabled'));
  document.getElementById(`ex1-opt-${chosen}`).classList.add(correct ? 'correct' : 'wrong');
  if (!correct) document.getElementById(`ex1-opt-${q.answer}`).classList.add('correct');
  
  if (correct) ex1Data.score++;
  
  document.getElementById('ex1-feedback').innerHTML = `
    <div class="feedback-bar ${correct ? 'success' : 'error'}">
      ${correct ? '‚úÖ' : '‚ùå'} ${correct ? 'Bravo !' : 'Pas tout √† fait...'} 
      Le compte ${q.num} est en <strong>classe ${q.answer}</strong> (${q.className}).
    </div>
  `;
  
  document.getElementById('ex1-buttons').innerHTML = `
    <button class="btn btn-primary" onclick="ex1Data.current++; renderEx1();">Suivant ‚ûú</button>
  `;
}

// ============================================================
// EXERCISE 2: CODIFICATION D√âCIMALE
// ============================================================
const ex2Questions = [
  { q: "Le num√©ro <strong>400</strong> est un compte de quel niveau ?", options: ["Classe", "Sous-classe", "Compte (utilisable)", "Sous-compte"], answer: 2 },
  { q: "Peut-on enregistrer une op√©ration dans le compte <strong>55</strong> (√âtablissements de cr√©dit) ?", options: ["Oui, c'est un compte normal", "Non, c'est un compte-titre (2 chiffres)"], answer: 1 },
  { q: "Le compte <strong>4000</strong> correspond √† quel niveau de pr√©cision ?", options: ["Classe", "Sous-classe", "Compte g√©n√©ral", "Sous-compte (d√©tail individuel)"], answer: 3 },
  { q: "Si un compte commence par le chiffre <strong>2</strong>, il fait partie de quelle cat√©gorie ?", options: ["Fonds propres et dettes √† long terme", "Actifs immobilis√©s (terrains, b√¢timents...)", "Stocks et commandes en cours", "Cr√©ances et dettes √† court terme"], answer: 1 },
  { q: "Quel est le nombre minimum de chiffres pour un compte utilisable ?", options: ["1 chiffre", "2 chiffres", "3 chiffres", "4 chiffres"], answer: 2 },
  { q: "Dans le num√©ro <strong>221</strong>, que repr√©sente le <strong>22</strong> ?", options: ["La classe", "La sous-classe (Terrains et constructions)", "Le compte", "Le sous-compte"], answer: 1 },
  { q: "Le compte <strong>173</strong> ¬´ √âtablissements de cr√©dit ¬ª est en classe 1. Il s'agit donc d'un compte de :", options: ["Actif (l'entreprise poss√®de)", "Passif (l'entreprise doit)", "Gestion (charges ou produits)"], answer: 1 },
  { q: "Un client s'appelle ¬´ Dupont ¬ª. On lui attribue le sous-compte <strong>4000</strong>. Quel compte g√©n√©ral est-ce ?", options: ["400 Clients", "440 Fournisseurs", "410 Cr√©ances diverses", "4 Cr√©ances et dettes"], answer: 0 },
];

let ex2Data = {};

function initEx2() {
  ex2Data = { questions: shuffle([...ex2Questions]).slice(0, 6), current: 0, score: 0, answered: false };
  renderEx2();
}

function renderEx2() {
  const d = ex2Data;
  if (d.current >= d.questions.length) {
    showExerciseResult('ex2-content', 'ex2-buttons', 1, d.score, d.questions.length);
    return;
  }
  const q = d.questions[d.current];
  d.answered = false;
  document.getElementById('ex2-feedback').innerHTML = '';
  
  const letters = ['A','B','C','D'];
  document.getElementById('ex2-content').innerHTML = `
    <div class="question-counter">Question ${d.current+1}/${d.questions.length}</div>
    <div class="question-text">${q.q}</div>
    <div class="options-grid">
      ${q.options.map((opt, i) => `
        <button class="option-btn" onclick="answerEx2(${i})" id="ex2-opt-${i}">
          <span class="opt-letter">${letters[i]}</span>
          <span>${opt}</span>
        </button>
      `).join('')}
    </div>
  `;
  document.getElementById('ex2-buttons').innerHTML = '';
}

function answerEx2(chosen) {
  if (ex2Data.answered) return;
  ex2Data.answered = true;
  const q = ex2Data.questions[ex2Data.current];
  const correct = chosen === q.answer;
  
  document.querySelectorAll('#ex2-content .option-btn').forEach(b => b.classList.add('disabled'));
  document.getElementById(`ex2-opt-${chosen}`).classList.add(correct ? 'correct' : 'wrong');
  if (!correct) document.getElementById(`ex2-opt-${q.answer}`).classList.add('correct');
  
  if (correct) ex2Data.score++;
  
  document.getElementById('ex2-feedback').innerHTML = `
    <div class="feedback-bar ${correct ? 'success' : 'error'}">
      ${correct ? '‚úÖ Correct !' : '‚ùå Ce n\'est pas √ßa.'} La bonne r√©ponse est : <strong>${q.options[q.answer]}</strong>.
    </div>
  `;
  
  document.getElementById('ex2-buttons').innerHTML = `
    <button class="btn btn-primary" onclick="ex2Data.current++; renderEx2();">Suivant ‚ûú</button>
  `;
}

// ============================================================
// EXERCISE 3: VRAI OU FAUX
// ============================================================
const ex3Questions = [
  { statement: "Le plan comptable belge contient 9 classes.", answer: false, explanation: "Le PCMN contient 7 classes (de 1 √† 7)." },
  { statement: "Le premier chiffre d'un num√©ro de compte indique toujours sa classe.", answer: true, explanation: "C'est exact ! Par exemple, 550 commence par 5, donc c'est la classe 5." },
  { statement: "Le compte 55 ¬´ √âtablissements de cr√©dit ¬ª peut √™tre utilis√© pour enregistrer des op√©rations.", answer: false, explanation: "C'est un compte-titre (2 chiffres). Il faut utiliser 550 (3 chiffres minimum)." },
  { statement: "La classe 6 fait partie des comptes de bilan.", answer: false, explanation: "La classe 6 (Charges) fait partie des comptes de gestion, pas du bilan." },
  { statement: "Le compte 440 Fournisseurs est un compte de passif.", answer: true, explanation: "Les fournisseurs repr√©sentent une dette, donc c'est bien un compte de passif." },
  { statement: "La classe 3 concerne les immeubles et les terrains.", answer: false, explanation: "La classe 3 concerne les stocks. Les immeubles et terrains sont en classe 2." },
  { statement: "Les classes 1 √† 5 servent √† dresser le bilan de l'entreprise.", answer: true, explanation: "Exact ! Le bilan reprend les comptes des classes 1 √† 5 (patrimoine de l'entreprise)." },
  { statement: "Un compte d'actif augmente au cr√©dit.", answer: false, explanation: "Un compte d'actif augmente au D√âBIT et diminue au cr√©dit." },
  { statement: "Le compte 400 Clients est un compte d'actif (cr√©ance commerciale).", answer: true, explanation: "Les clients nous doivent de l'argent : c'est un avoir (actif) pour l'entreprise." },
  { statement: "Le solde d'un compte de passif est normalement d√©biteur.", answer: false, explanation: "Le solde d'un compte de passif est normalement CR√âDITEUR." },
  { statement: "La classe 4 contient √† la fois des comptes d'actif et de passif.", answer: true, explanation: "Exact ! 400 Clients = actif, 440 Fournisseurs = passif." },
  { statement: "Un compte de passif augmente au d√©bit.", answer: false, explanation: "Un compte de passif augmente au CR√âDIT et diminue au d√©bit." },
];

let ex3Data = {};

function initEx3() {
  ex3Data = { questions: shuffle([...ex3Questions]).slice(0, 8), current: 0, score: 0, answered: false };
  renderEx3();
}

function renderEx3() {
  const d = ex3Data;
  if (d.current >= d.questions.length) {
    showExerciseResult('ex3-content', 'ex3-buttons', 2, d.score, d.questions.length);
    return;
  }
  const q = d.questions[d.current];
  d.answered = false;
  document.getElementById('ex3-feedback').innerHTML = '';
  
  document.getElementById('ex3-content').innerHTML = `
    <div class="question-counter">Affirmation ${d.current+1}/${d.questions.length}</div>
    <div class="question-text" style="font-size:1.1rem; padding:16px 0;">"${q.statement}"</div>
    <div class="vf-toggle-group">
      <button class="vf-btn" id="ex3-vrai" onclick="answerEx3(true)">‚úÖ VRAI</button>
      <button class="vf-btn" id="ex3-faux" onclick="answerEx3(false)">‚ùå FAUX</button>
    </div>
  `;
  document.getElementById('ex3-buttons').innerHTML = '';
}

function answerEx3(chosen) {
  if (ex3Data.answered) return;
  ex3Data.answered = true;
  const q = ex3Data.questions[ex3Data.current];
  const correct = chosen === q.answer;
  
  if (correct) ex3Data.score++;
  
  const vraiBtn = document.getElementById('ex3-vrai');
  const fauxBtn = document.getElementById('ex3-faux');
  
  // Highlight the correct answer
  if (q.answer === true) { vraiBtn.classList.add('correct-answer'); } 
  else { fauxBtn.classList.add('correct-answer'); }
  
  // Highlight wrong if needed
  if (!correct) {
    if (chosen === true) vraiBtn.classList.add('wrong-answer');
    else fauxBtn.classList.add('wrong-answer');
  }
  
  document.getElementById('ex3-feedback').innerHTML = `
    <div class="feedback-bar ${correct ? 'success' : 'error'}">
      ${correct ? '‚úÖ Bonne r√©ponse !' : '‚ùå Mauvaise r√©ponse.'} ${q.explanation}
    </div>
  `;
  
  document.getElementById('ex3-buttons').innerHTML = `
    <button class="btn btn-primary" onclick="ex3Data.current++; renderEx3();">Suivant ‚ûú</button>
  `;
}

// ============================================================
// EXERCISE 4: DU CONCRET AU COMPTABLE (Matching)
// ============================================================
const ex4Items = [
  { concrete: "üöê Camionnette de livraison", account: "241 Mat√©riel roulant", class: 2 },
  { concrete: "üñ•Ô∏è Ordinateur du bureau", account: "240 Mobilier & mat. bureau", class: 2 },
  { concrete: "üíµ Billets dans le tiroir-caisse", account: "570 Caisse esp√®ces", class: 5 },
  { concrete: "üè¢ Entrep√¥t de stockage", account: "221 Constructions", class: 2 },
  { concrete: "üè¶ Emprunt de 5 ans chez ING", account: "173 √âtablissements de cr√©dit", class: 1 },
  { concrete: "üë§ M. Martin nous doit 800 ‚Ç¨", account: "400 Clients", class: 4 },
  { concrete: "üì¶ Stock de tablettes en rayon", account: "340 Marchandises", class: 3 },
  { concrete: "üí≥ Nous devons 3 000 ‚Ç¨ √† Apple", account: "440 Fournisseurs", class: 4 },
  { concrete: "üåç Terrain derri√®re le magasin", account: "220 Terrains", class: 2 },
  { concrete: "üèß Solde du compte BNP Paribas", account: "550 Banque cpte courant", class: 5 },
];

let ex4Data = {};

function initEx4() {
  const items = shuffle([...ex4Items]).slice(0, 8);
  ex4Data = { items, current: 0, score: 0, answered: false };
  renderEx4();
}

function renderEx4() {
  const d = ex4Data;
  if (d.current >= d.items.length) {
    showExerciseResult('ex4-content', 'ex4-buttons', 3, d.score, d.items.length);
    return;
  }
  
  const item = d.items[d.current];
  d.answered = false;
  document.getElementById('ex4-feedback').innerHTML = '';
  
  // Generate wrong options + correct one
  const allAccounts = ex4Items.map(x => x.account);
  let options = [item.account];
  const others = allAccounts.filter(a => a !== item.account);
  const shuffledOthers = shuffle(others);
  options.push(shuffledOthers[0], shuffledOthers[1], shuffledOthers[2]);
  options = shuffle(options);
  
  const letters = ['A','B','C','D'];
  document.getElementById('ex4-content').innerHTML = `
    <div class="question-counter">√âl√©ment ${d.current+1}/${d.items.length}</div>
    <div class="question-scenario">${item.concrete}</div>
    <div class="question-text">Quel est le bon compte comptable pour cet √©l√©ment ?</div>
    <div class="options-grid">
      ${options.map((opt, i) => `
        <button class="option-btn" onclick="answerEx4(${i}, '${opt.replace(/'/g, "\\'")}')" id="ex4-opt-${i}">
          <span class="opt-letter">${letters[i]}</span>
          <span>${opt}</span>
        </button>
      `).join('')}
    </div>
  `;
  document.getElementById('ex4-buttons').innerHTML = '';
}

function answerEx4(idx, chosen) {
  if (ex4Data.answered) return;
  ex4Data.answered = true;
  const item = ex4Data.items[ex4Data.current];
  const correct = chosen === item.account;
  
  if (correct) ex4Data.score++;
  
  document.querySelectorAll('#ex4-content .option-btn').forEach((b, i) => {
    b.classList.add('disabled');
    if (b.querySelector('span:last-child').textContent === item.account) b.classList.add('correct');
  });
  if (!correct) document.getElementById(`ex4-opt-${idx}`).classList.add('wrong');
  
  document.getElementById('ex4-feedback').innerHTML = `
    <div class="feedback-bar ${correct ? 'success' : 'error'}">
      ${correct ? '‚úÖ Exact !' : '‚ùå Pas tout √† fait.'} 
      ${item.concrete} ‚Üí <strong>${item.account}</strong> (Classe ${item.class}).
    </div>
  `;
  
  document.getElementById('ex4-buttons').innerHTML = `
    <button class="btn btn-primary" onclick="ex4Data.current++; renderEx4();">Suivant ‚ûú</button>
  `;
}

// ============================================================
// EXERCISE 5: ACTIF/PASSIF & D√âBIT/CR√âDIT
// ============================================================
const ex5Questions = [
  { situation: "Le client Dupont paie sa facture de 500 ‚Ç¨ par virement bancaire.", account: "550 Banque", type: "actif", direction: "d√©bit", why: "L'argent entre en banque ‚Üí le compte d'actif Banque AUGMENTE ‚Üí on enregistre au D√âBIT." },
  { situation: "L'entreprise paie une facture de 2 000 ‚Ç¨ au fournisseur Dell par banque.", account: "440 Fournisseurs", type: "passif", direction: "d√©bit", why: "On rembourse une dette ‚Üí le compte de passif Fournisseurs DIMINUE ‚Üí on enregistre au D√âBIT." },
  { situation: "L'entreprise contracte un emprunt de 50 000 ‚Ç¨ aupr√®s de BNP Paribas.", account: "173 Emprunt bancaire", type: "passif", direction: "cr√©dit", why: "Une nouvelle dette appara√Æt ‚Üí le compte de passif Emprunt AUGMENTE ‚Üí on enregistre au CR√âDIT." },
  { situation: "L'entreprise ach√®te un v√©hicule utilitaire pour 25 000 ‚Ç¨ (pas encore pay√©).", account: "241 Mat√©riel roulant", type: "actif", direction: "d√©bit", why: "Un nouvel avoir ‚Üí le compte d'actif Mat√©riel roulant AUGMENTE ‚Üí on enregistre au D√âBIT." },
  { situation: "L'entreprise retire 300 ‚Ç¨ en esp√®ces de son compte en banque.", account: "550 Banque", type: "actif", direction: "cr√©dit", why: "L'argent sort de la banque ‚Üí le compte d'actif Banque DIMINUE ‚Üí on enregistre au CR√âDIT." },
  { situation: "L'entreprise retire 300 ‚Ç¨ en esp√®ces de son compte en banque.", account: "570 Caisse", type: "actif", direction: "d√©bit", why: "L'argent entre dans la caisse ‚Üí le compte d'actif Caisse AUGMENTE ‚Üí on enregistre au D√âBIT." },
  { situation: "Le fournisseur Samsung nous accorde un cr√©dit de 5 000 ‚Ç¨ pour du mat√©riel.", account: "440 Fournisseurs", type: "passif", direction: "cr√©dit", why: "Une nouvelle dette fournisseur ‚Üí le compte de passif AUGMENTE ‚Üí on enregistre au CR√âDIT." },
  { situation: "L'entreprise vend un terrain pour 40 000 ‚Ç¨, pay√© par virement.", account: "220 Terrains", type: "actif", direction: "cr√©dit", why: "Un avoir dispara√Æt ‚Üí le compte d'actif Terrains DIMINUE ‚Üí on enregistre au CR√âDIT." },
  { situation: "L'associ√© apporte 20 000 ‚Ç¨ suppl√©mentaires au capital.", account: "100 Capital", type: "passif", direction: "cr√©dit", why: "Le capital augmente ‚Üí le compte de passif Capital AUGMENTE ‚Üí on enregistre au CR√âDIT." },
  { situation: "On ach√®te du stock de marchandises pour 8 000 ‚Ç¨ (pas encore pay√©).", account: "340 Marchandises", type: "actif", direction: "d√©bit", why: "Le stock augmente ‚Üí le compte d'actif Marchandises AUGMENTE ‚Üí on enregistre au D√âBIT." },
];

let ex5Data = {};

function initEx5() {
  ex5Data = { questions: shuffle([...ex5Questions]).slice(0, 8), current: 0, score: 0, answered: false };
  renderEx5();
}

function renderEx5() {
  const d = ex5Data;
  if (d.current >= d.questions.length) {
    showExerciseResult('ex5-content', 'ex5-buttons', 4, d.score, d.questions.length * 2);
    return;
  }
  const q = d.questions[d.current];
  d.answered = false;
  document.getElementById('ex5-feedback').innerHTML = '';
  
  document.getElementById('ex5-content').innerHTML = `
    <div class="question-counter">Situation ${d.current+1}/${d.questions.length}</div>
    <div class="question-scenario">${q.situation}</div>
    <div class="question-text">Pour le compte <strong style="color:var(--accent-cyan);">${q.account}</strong> :</div>
    
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-top:12px;">
      <div>
        <p style="font-weight:700; font-size:0.85rem; margin-bottom:8px; color:var(--text-secondary);">1. Type de compte :</p>
        <div class="vf-toggle-group">
          <button class="vf-btn" id="ex5-actif" onclick="selectEx5Type('actif')">üîµ ACTIF</button>
          <button class="vf-btn" id="ex5-passif" onclick="selectEx5Type('passif')">üü† PASSIF</button>
        </div>
      </div>
      <div>
        <p style="font-weight:700; font-size:0.85rem; margin-bottom:8px; color:var(--text-secondary);">2. On enregistre au :</p>
        <div class="vf-toggle-group">
          <button class="vf-btn" id="ex5-debit" onclick="selectEx5Dir('d√©bit')">‚óÄ D√âBIT</button>
          <button class="vf-btn" id="ex5-credit" onclick="selectEx5Dir('cr√©dit')">CR√âDIT ‚ñ∂</button>
        </div>
      </div>
    </div>
    
    <div class="btn-group" style="margin-top:16px;">
      <button class="btn btn-primary" id="ex5-validate" onclick="validateEx5()" disabled>Valider ma r√©ponse</button>
    </div>
  `;
  document.getElementById('ex5-buttons').innerHTML = '';
  ex5Data.selectedType = null;
  ex5Data.selectedDir = null;
}

function selectEx5Type(t) {
  if (ex5Data.answered) return;
  ex5Data.selectedType = t;
  document.getElementById('ex5-actif').className = 'vf-btn' + (t === 'actif' ? ' selected-v' : '');
  document.getElementById('ex5-passif').className = 'vf-btn' + (t === 'passif' ? ' selected-f' : '');
  checkEx5Ready();
}

function selectEx5Dir(d) {
  if (ex5Data.answered) return;
  ex5Data.selectedDir = d;
  document.getElementById('ex5-debit').className = 'vf-btn' + (d === 'd√©bit' ? ' selected-v' : '');
  document.getElementById('ex5-credit').className = 'vf-btn' + (d === 'cr√©dit' ? ' selected-f' : '');
  checkEx5Ready();
}

function checkEx5Ready() {
  document.getElementById('ex5-validate').disabled = !(ex5Data.selectedType && ex5Data.selectedDir);
}

function validateEx5() {
  if (ex5Data.answered) return;
  ex5Data.answered = true;
  const q = ex5Data.questions[ex5Data.current];
  const typeCorrect = ex5Data.selectedType === q.type;
  const dirCorrect = ex5Data.selectedDir === q.direction;
  
  let pts = 0;
  if (typeCorrect) pts++;
  if (dirCorrect) pts++;
  ex5Data.score += pts;
  
  // Highlight
  document.getElementById(`ex5-${q.type}`).classList.add('correct-answer');
  document.getElementById(`ex5-${q.direction === 'd√©bit' ? 'debit' : 'credit'}`).classList.add('correct-answer');
  if (!typeCorrect) document.getElementById(`ex5-${ex5Data.selectedType}`).classList.add('wrong-answer');
  if (!dirCorrect) document.getElementById(`ex5-${ex5Data.selectedDir === 'd√©bit' ? 'debit' : 'credit'}`).classList.add('wrong-answer');
  
  document.getElementById('ex5-validate').disabled = true;
  
  const allCorrect = typeCorrect && dirCorrect;
  document.getElementById('ex5-feedback').innerHTML = `
    <div class="feedback-bar ${allCorrect ? 'success' : (pts > 0 ? 'info' : 'error')}">
      ${allCorrect ? '‚úÖ Parfait !' : (pts > 0 ? '‚ö†Ô∏è Partiellement correct.' : '‚ùå Pas cette fois.')} 
      ${q.why}
    </div>
  `;
  
  document.getElementById('ex5-buttons').innerHTML = `
    <button class="btn btn-primary" onclick="ex5Data.current++; renderEx5();">Suivant ‚ûú</button>
  `;
}

// ============================================================
// EXERCISE 6: COMPL√âTER UN COMPTE
// ============================================================
let ex6Data = {};

function initEx6() {
  ex6Data = { step: 0, score: 0, maxScore: 12 };
  renderEx6();
}

function renderEx6() {
  if (ex6Data.step === 0) renderEx6Account1();
  else if (ex6Data.step === 1) renderEx6Account2();
  else showExerciseResult('ex6-content', 'ex6-buttons', 5, ex6Data.score, ex6Data.maxScore);
}

function renderEx6Account1() {
  document.getElementById('ex6-feedback').innerHTML = '';
  document.getElementById('ex6-content').innerHTML = `
    <p style="margin-bottom:16px; color:var(--text-secondary); font-size:0.9rem;">
      <strong>Partie A :</strong> Compl√®te le compte <strong style="color:var(--accent-cyan);">550 Banque</strong> (compte d'actif) de FleurShop SRL.
    </p>
    <div class="account-title-bar">
      <span>550 Banque (Compte d'Actif)</span>
      <span>üí≥</span>
    </div>
    <table class="account-table">
      <thead>
        <tr><th>Date</th><th>Libell√©</th><th>N¬∞</th><th>D√©bit</th><th>Cr√©dit</th><th>Solde</th></tr>
      </thead>
      <tbody>
        <tr>
          <td>02/01</td><td style="text-align:left;">Situation initiale</td><td>‚Äî</td>
          <td class="debit-col">12 000,00</td><td class="credit-col">‚Äî</td>
          <td><input type="text" id="ex6a-s1" placeholder="?" data-answer="12000"></td>
        </tr>
        <tr>
          <td>05/01</td><td style="text-align:left;">Paiement fournisseur Fleurexpo</td><td>1</td>
          <td class="debit-col">‚Äî</td><td class="credit-col">3 500,00</td>
          <td><input type="text" id="ex6a-s2" placeholder="?" data-answer="8500"></td>
        </tr>
        <tr>
          <td>10/01</td><td style="text-align:left;">Encaissement client Martin</td><td>2</td>
          <td class="debit-col">2 200,00</td><td class="credit-col">‚Äî</td>
          <td><input type="text" id="ex6a-s3" placeholder="?" data-answer="10700"></td>
        </tr>
        <tr>
          <td>15/01</td><td style="text-align:left;">Loyer du magasin</td><td>3</td>
          <td class="debit-col">‚Äî</td><td class="credit-col">1 800,00</td>
          <td><input type="text" id="ex6a-s4" placeholder="?" data-answer="8900"></td>
        </tr>
        <tr>
          <td>22/01</td><td style="text-align:left;">Encaissement client Dubois</td><td>4</td>
          <td class="debit-col">4 600,00</td><td class="credit-col">‚Äî</td>
          <td><input type="text" id="ex6a-s5" placeholder="?" data-answer="13500"></td>
        </tr>
        <tr>
          <td>28/01</td><td style="text-align:left;">Paiement assurance annuelle</td><td>5</td>
          <td class="debit-col">‚Äî</td><td class="credit-col">2 400,00</td>
          <td><input type="text" id="ex6a-s6" placeholder="?" data-answer="11100"></td>
        </tr>
      </tbody>
    </table>
    <p style="font-size:0.8rem; color:var(--text-muted);">üí° Rappel : Actif ‚Üí D√©bit = augmentation, Cr√©dit = diminution. Entre le solde sans d√©cimales.</p>
  `;
  document.getElementById('ex6-buttons').innerHTML = `
    <button class="btn btn-primary" onclick="checkEx6Account1()">V√©rifier mes r√©ponses</button>
  `;
}

function checkEx6Account1() {
  let pts = 0;
  for (let i = 1; i <= 6; i++) {
    const input = document.getElementById(`ex6a-s${i}`);
    const val = input.value.replace(/[\s.,‚Ç¨]/g, '').trim();
    const answer = input.dataset.answer;
    if (val === answer) {
      input.classList.add('input-correct');
      input.classList.remove('input-wrong');
      pts++;
    } else {
      input.classList.add('input-wrong');
      input.classList.remove('input-correct');
    }
  }
  ex6Data.score += pts;
  
  document.getElementById('ex6-feedback').innerHTML = `
    <div class="feedback-bar ${pts >= 5 ? 'success' : (pts >= 3 ? 'info' : 'error')}">
      ${pts >= 5 ? '‚úÖ Excellent !' : '‚ö†Ô∏è'} Tu as trouv√© <strong>${pts}/6</strong> soldes corrects.
      ${pts < 6 ? ' Le solde se calcule : solde pr√©c√©dent + d√©bit - cr√©dit.' : ''}
    </div>
  `;
  
  document.getElementById('ex6-buttons').innerHTML = `
    <button class="btn btn-primary" onclick="ex6Data.step=1; renderEx6();">Partie B : Compte de passif ‚ûú</button>
  `;
}

function renderEx6Account2() {
  document.getElementById('ex6-feedback').innerHTML = '';
  document.getElementById('ex6-content').innerHTML = `
    <p style="margin-bottom:16px; color:var(--text-secondary); font-size:0.9rem;">
      <strong>Partie B :</strong> Compl√®te le compte <strong style="color:var(--accent-orange);">440 Fournisseurs</strong> (compte de passif) de FleurShop SRL.
    </p>
    <div class="account-title-bar" style="background:linear-gradient(90deg, var(--accent-orange), var(--accent-pink));">
      <span>440 Fournisseurs (Compte de Passif)</span>
      <span>üì¶</span>
    </div>
    <table class="account-table">
      <thead>
        <tr><th>Date</th><th>Libell√©</th><th>N¬∞</th><th>D√©bit</th><th>Cr√©dit</th><th>Solde</th></tr>
      </thead>
      <tbody>
        <tr>
          <td>02/01</td><td style="text-align:left;">Situation initiale</td><td>‚Äî</td>
          <td class="debit-col">‚Äî</td><td class="credit-col">6 000,00</td>
          <td><input type="text" id="ex6b-s1" placeholder="?" data-answer="6000"></td>
        </tr>
        <tr>
          <td>05/01</td><td style="text-align:left;">Paiement fournisseur Fleurexpo</td><td>1</td>
          <td class="debit-col">3 500,00</td><td class="credit-col">‚Äî</td>
          <td><input type="text" id="ex6b-s2" placeholder="?" data-answer="2500"></td>
        </tr>
        <tr>
          <td>12/01</td><td style="text-align:left;">Facture n¬∞78 de RoseImport</td><td>2</td>
          <td class="debit-col">‚Äî</td><td class="credit-col">4 200,00</td>
          <td><input type="text" id="ex6b-s3" placeholder="?" data-answer="6700"></td>
        </tr>
        <tr>
          <td>18/01</td><td style="text-align:left;">Paiement fournisseur RoseImport</td><td>3</td>
          <td class="debit-col">2 000,00</td><td class="credit-col">‚Äî</td>
          <td><input type="text" id="ex6b-s4" placeholder="?" data-answer="4700"></td>
        </tr>
        <tr>
          <td>25/01</td><td style="text-align:left;">Facture n¬∞112 de VaseD√©co</td><td>4</td>
          <td class="debit-col">‚Äî</td><td class="credit-col">1 500,00</td>
          <td><input type="text" id="ex6b-s5" placeholder="?" data-answer="6200"></td>
        </tr>
        <tr>
          <td>30/01</td><td style="text-align:left;">Paiement solde Fleurexpo</td><td>5</td>
          <td class="debit-col">2 500,00</td><td class="credit-col">‚Äî</td>
          <td><input type="text" id="ex6b-s6" placeholder="?" data-answer="3700"></td>
        </tr>
      </tbody>
    </table>
    <p style="font-size:0.8rem; color:var(--text-muted);">üí° Rappel : Passif ‚Üí Cr√©dit = augmentation, D√©bit = diminution. Entre le solde sans d√©cimales.</p>
  `;
  document.getElementById('ex6-buttons').innerHTML = `
    <button class="btn btn-primary" onclick="checkEx6Account2()">V√©rifier mes r√©ponses</button>
  `;
}

function checkEx6Account2() {
  let pts = 0;
  for (let i = 1; i <= 6; i++) {
    const input = document.getElementById(`ex6b-s${i}`);
    const val = input.value.replace(/[\s.,‚Ç¨]/g, '').trim();
    const answer = input.dataset.answer;
    if (val === answer) {
      input.classList.add('input-correct');
      input.classList.remove('input-wrong');
      pts++;
    } else {
      input.classList.add('input-wrong');
      input.classList.remove('input-correct');
    }
  }
  ex6Data.score += pts;
  
  document.getElementById('ex6-feedback').innerHTML = `
    <div class="feedback-bar ${pts >= 5 ? 'success' : (pts >= 3 ? 'info' : 'error')}">
      ${pts >= 5 ? '‚úÖ Tr√®s bien !' : '‚ö†Ô∏è'} Tu as trouv√© <strong>${pts}/6</strong> soldes corrects.
      ${pts < 6 ? ' Pour un compte de passif : solde pr√©c√©dent + cr√©dit - d√©bit.' : ''}
    </div>
  `;
  
  document.getElementById('ex6-buttons').innerHTML = `
    <button class="btn btn-primary" onclick="ex6Data.step=2; renderEx6();">Voir mon r√©sultat ‚ûú</button>
  `;
}

// ============================================================
// EXERCISE 7: BILAN COMPLET
// ============================================================
const ex7Elements = [
  { name: "Capital souscrit", num: "100", amount: 80000, side: "passif" },
  { name: "Terrain", num: "220", amount: 35000, side: "actif" },
  { name: "Mat√©riel informatique", num: "240", amount: 18000, side: "actif" },
  { name: "Constructions (bureaux)", num: "221", amount: 55000, side: "actif" },
  { name: "Banque compte courant", num: "550", amount: 22000, side: "actif" },
  { name: "Emprunt bancaire (5 ans)", num: "173", amount: 40000, side: "passif" },
  { name: "Clients", num: "400", amount: 8500, side: "actif" },
  { name: "Fournisseurs", num: "440", amount: 12000, side: "passif" },
  { name: "Caisse esp√®ces", num: "570", amount: 1500, side: "actif" },
  { name: "Marchandises", num: "340", amount: 6000, side: "actif" },
  { name: "Mat√©riel roulant", num: "241", amount: 15000, side: "actif" },
  { name: "R√©serve l√©gale", num: "130", amount: 29000, side: "passif" },
];

let ex7Data = {};

function initEx7() {
  ex7Data = { elements: shuffle([...ex7Elements]), answers: {}, score: 0 };
  renderEx7();
}

function renderEx7() {
  document.getElementById('ex7-feedback').innerHTML = '';
  
  const elHTML = ex7Data.elements.map((el, i) => `
    <div style="display:flex; align-items:center; gap:10px; padding:10px 14px; background:rgba(255,255,255,0.02); border:1px solid var(--border); border-radius:8px; margin-bottom:8px;">
      <span style="font-family:'JetBrains Mono',monospace; color:var(--accent-cyan); font-size:0.85rem; width:40px;">${el.num}</span>
      <span style="flex:1; font-weight:600; font-size:0.9rem;">${el.name}</span>
      <span style="font-family:'JetBrains Mono',monospace; font-weight:600; color:var(--accent-yellow);">${el.amount.toLocaleString('fr-BE')} ‚Ç¨</span>
      <select class="styled-select" id="ex7-sel-${i}" onchange="ex7Data.answers[${i}]=this.value">
        <option value="">Choisir...</option>
        <option value="actif">ACTIF</option>
        <option value="passif">PASSIF</option>
      </select>
    </div>
  `).join('');
  
  document.getElementById('ex7-content').innerHTML = `
    <p style="margin-bottom:16px; color:var(--text-secondary); font-size:0.9rem;">
      Pour chaque √©l√©ment de <strong>PixelWeb SRL</strong>, indique s'il va √† l'<strong style="color:var(--accent-blue);">ACTIF</strong> 
      ou au <strong style="color:var(--accent-orange);">PASSIF</strong> du bilan.
    </p>
    ${elHTML}
  `;
  
  document.getElementById('ex7-buttons').innerHTML = `
    <button class="btn btn-primary" onclick="checkEx7()">V√©rifier le bilan</button>
  `;
}

function checkEx7() {
  let pts = 0;
  let totalActif = 0, totalPassif = 0;
  
  ex7Data.elements.forEach((el, i) => {
    const sel = document.getElementById(`ex7-sel-${i}`);
    const chosen = sel.value;
    if (chosen === el.side) {
      sel.classList.add('input-correct');
      sel.classList.remove('input-wrong');
      pts++;
    } else {
      sel.classList.add('input-wrong');
      sel.classList.remove('input-correct');
    }
    if (el.side === 'actif') totalActif += el.amount;
    else totalPassif += el.amount;
  });
  
  ex7Data.score = pts;
  const allCorrect = pts === ex7Data.elements.length;
  
  let bilanHTML = '';
  if (allCorrect) {
    const actifItems = ex7Data.elements.filter(e => e.side === 'actif').sort((a,b) => parseInt(a.num) - parseInt(b.num));
    const passifItems = ex7Data.elements.filter(e => e.side === 'passif').sort((a,b) => parseInt(a.num) - parseInt(b.num));
    
    bilanHTML = `
      <div style="margin-top:20px;">
        <h3 style="font-family:'Fredoka',sans-serif; text-align:center; margin-bottom:12px; color:var(--accent-cyan);">üìä Bilan de PixelWeb SRL au 01/01</h3>
        <div class="bilan-grid">
          <div class="bilan-side actif">
            <h3>ACTIF</h3>
            ${actifItems.map(e => `
              <div class="bilan-row">
                <span>${e.num} ${e.name}</span>
                <span class="bilan-amount">${e.amount.toLocaleString('fr-BE')} ‚Ç¨</span>
              </div>
            `).join('')}
            <div class="bilan-total">
              <span>TOTAL ACTIF</span>
              <span>${totalActif.toLocaleString('fr-BE')} ‚Ç¨</span>
            </div>
          </div>
          <div class="bilan-side passif">
            <h3>PASSIF</h3>
            ${passifItems.map(e => `
              <div class="bilan-row">
                <span>${e.num} ${e.name}</span>
                <span class="bilan-amount">${e.amount.toLocaleString('fr-BE')} ‚Ç¨</span>
              </div>
            `).join('')}
            <div class="bilan-total">
              <span>TOTAL PASSIF</span>
              <span>${totalPassif.toLocaleString('fr-BE')} ‚Ç¨</span>
            </div>
          </div>
        </div>
        <div style="text-align:center; margin-top:12px; padding:10px; background:rgba(34,197,94,0.1); border-radius:8px; border:1px solid rgba(34,197,94,0.3);">
          ‚úÖ <strong>ACTIF = PASSIF = ${totalActif.toLocaleString('fr-BE')} ‚Ç¨</strong> ‚Äî Le bilan est √©quilibr√© !
        </div>
      </div>
    `;
  }
  
  document.getElementById('ex7-feedback').innerHTML = `
    <div class="feedback-bar ${allCorrect ? 'success' : (pts >= 8 ? 'info' : 'error')}">
      ${allCorrect ? 'üéâ Parfait !' : '‚ö†Ô∏è'} Tu as class√© correctement <strong>${pts}/${ex7Data.elements.length}</strong> √©l√©ments.
      ${!allCorrect ? ' Rappel : les avoirs (ce que l\'entreprise poss√®de) vont √† l\'ACTIF, les dettes et le capital vont au PASSIF.' : ''}
    </div>
    ${bilanHTML}
  `;
  
  if (allCorrect) {
    document.getElementById('ex7-buttons').innerHTML = `
      <button class="btn btn-success" onclick="showExerciseResult('ex7-content','ex7-buttons',6,${pts},${ex7Data.elements.length})">Voir mon r√©sultat final üèÜ</button>
    `;
  } else {
    document.getElementById('ex7-buttons').innerHTML = `
      <button class="btn btn-outline" onclick="initEx7()">üîÑ R√©essayer</button>
      <button class="btn btn-primary" onclick="showExerciseResult('ex7-content','ex7-buttons',6,${pts},${ex7Data.elements.length})">Voir mon r√©sultat ‚ûú</button>
    `;
  }
}

// ============================================================
// FINAL RESULTS
// ============================================================
function showFinalResults() {
  showPanel('final');
  
  const totalPossible = state.maxScores.reduce((a,b) => a+b, 0);
  const totalGot = state.scores.reduce((a,b) => a+b, 0);
  const pct = totalPossible > 0 ? Math.round((totalGot / totalPossible) * 100) : 0;
  
  let rank = 'ü•â Apprenti comptable';
  let color = 'var(--accent-orange)';
  if (pct >= 90) { rank = 'üèÜ Expert PCMN'; color = 'var(--accent-yellow)'; }
  else if (pct >= 75) { rank = 'ü•à Comptable confirm√©'; color = 'var(--text-secondary)'; }
  else if (pct >= 60) { rank = 'ü•â Comptable en devenir'; color = 'var(--accent-orange)'; }
  
  const details = exercises.map((ex, i) => {
    const s = state.scores[i];
    const m = state.maxScores[i];
    const stars = getStars(s, m);
    return `
      <div style="display:flex; align-items:center; gap:12px; padding:10px 14px; background:rgba(255,255,255,0.02); border-radius:8px; margin-bottom:6px;">
        <span style="font-size:1.3rem;">${ex.icon}</span>
        <span style="flex:1; font-weight:600;">${ex.name}</span>
        <span style="font-family:'JetBrains Mono',monospace; font-size:0.85rem;">${s}/${m}</span>
        <span>${starsHTML(stars)}</span>
      </div>
    `;
  }).join('');
  
  document.getElementById('final-content').innerHTML = `
    <div style="font-size:3rem; margin-bottom:10px;">üéì</div>
    <h2 style="font-family:'Fredoka',sans-serif; font-size:1.8rem; margin-bottom:6px;">R√©sultats finaux</h2>
    <p style="color:${color}; font-family:'Fredoka',sans-serif; font-size:1.2rem; font-weight:600; margin-bottom:20px;">${rank}</p>
    
    <div class="score-circle ${pct >= 90 ? 'gold' : (pct >= 60 ? 'silver' : 'bronze')}" style="margin-bottom:20px;">
      <span class="score-num">${pct}%</span>
      <span class="score-label">${totalGot}/${totalPossible} pts</span>
    </div>
    
    <div style="text-align:left; max-width:500px; margin:0 auto 20px;">
      <h3 style="font-family:'Fredoka',sans-serif; font-size:1rem; margin-bottom:10px; color:var(--text-secondary);">D√©tail par exercice :</h3>
      ${details}
    </div>
    
    <div class="btn-group" style="justify-content:center;">
      <button class="btn btn-outline" onclick="resetGame()">üîÑ Tout recommencer</button>
    </div>
  `;
  
  if (pct >= 75) launchConfetti();
}

function resetGame() {
  state.scores = [0,0,0,0,0,0,0];
  state.maxScores = [0,0,0,0,0,0,0];
  state.completed = [false,false,false,false,false,false,false];
  state.totalScore = 0;
  state.currentExercise = 0;
  updateProgress();
  buildNav();
  showPanel('welcome');
}

// ============================================================
// UTILITIES
// ============================================================
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

// ============================================================
// INIT
// ============================================================
buildNav();
updateProgress();
</script>
</body>
</html>
